"commit id","commit date","commit message"
"51aa34d52b8b40e0325b306f49b5726b879a4c42","2014-04-27 03:29:06+02:00","Don't use enum ordinal as array index

This fixes a crash when setting up WebDAV accounts.
"
"615a1ae9a71cac9a1d03ebfec876e072aa732ff1","2014-04-28 15:35:33+09:00","Remove duplicate code. use Utility.hasConnectivity()
"
"59ae1d034c323c220866b70315456150a87abbd4","2014-04-29 15:33:20+09:00","Add build.gradle for tests-on-jvm
"
"9a99c77653cb29d4165aa24b42a44f5dae585443","2014-04-29 21:48:51+09:00","Add a gradle task testsOnJVM.
"
"6155a65f65d20944bb1259cffc373b596c53a59e","2013-09-22 12:50:01+09:00","Refactoring: extract a class TextBodyBuilder
"
"a08687b70e2e3ace85f144ff8ac9f41361e23320","2014-05-02 08:28:42+09:00","Use local variable for more readability.
"
"56a48476e4cf0aa1c2421f608538363b7755f1f6","2014-05-02 08:36:46+09:00","Rename mDraft to mInsertSeparator.
"
"421879e9cfb2530c85c461a86f07745c35d8ddeb","2014-05-02 08:39:07+09:00","Remove unused getter
"
"7fd52a735d9972bff8393aa220a3efb426f408c6","2014-05-02 08:43:40+09:00","fixup! Rename mDraft to mInsertSeparator.
"
"00fb83e1b3cb95db4a877006a0310ee3cb839fc7","2014-05-02 08:49:01+09:00","fixup! Use local variable for more readability
"
"e163fb87e14c80c5ab3053d478d97899baf40f55","2014-05-02 09:06:23+09:00","set signature parameter when it is only necessary
"
"71e766999c3de215fa22996e52ab1cf4d3c709d5","2014-05-02 09:11:31+09:00","adapt to product code
"
"68850b1dc94ddcd94d499d3b98e3d7237dae7096","2014-05-02 09:43:14+09:00","Use setter for quoted text like signature
"
"4260dc75d3f386c2f4ffcb05f5fef026b9136f49","2014-05-02 10:45:20+09:00","more refactor about quoted text
"
"215ada2e77c72b80caf6039e0a66359655bf04dd","2014-05-02 13:18:36+09:00","astyle
"
"0a09060ed76fa1c44dedf7005637b8eaac43b200","2014-05-02 13:42:05+09:00","adapt to product code
"
"9c5b9cce90b8920a17706851c38322e44f34ce08","2014-05-02 14:25:45+09:00","Adapt to the astyle version 2.04.

* max-instatement-indent:
The valid value is 40 thru 120.

* brackets=attach:
We should change the brackets options to the style option in v2.02 or later.

For more detail, see the http://astyle.sourceforge.net/news.html.
"
"3a02bfb0a95adc66bcc687b4868aefc38141088e","2014-05-02 14:07:03+09:00","I have deleted a change in 0323af0.
"
"a9cfa9ae684ad6c6362fa0299fd30d9a9290f0f3","2014-05-03 06:06:15+02:00","Code style

No functional changes
"
"e2cffa074fa966eaadc6d89e85d94a90beb45c62","2014-05-03 06:33:33+02:00","Update/remove comments
"
"e0ce5fc4ce9f200270ad0e949afa0f4b974653a3","2014-03-23 11:17:11-04:00","Eliminate superclass callbacks

Service components don't need to call
super.onCreate() and super.onDestroy()
"
"f17b45c1524614ca0d0787100ea2a04104da688b","2014-04-04 19:58:30-04:00","Provide Eclipse .project file for new plugin

This gives the openpgp-api-library an Eclipse
project name consistent with the names used for
the other plugins.  This helps with initial
project setup and avoids project naming collisions.
"
"5cc4d7c6a916117efbf21873c3338835697dd2c6","2014-04-05 23:43:53-04:00","Avoid NPE in MessageOpenPgpView.updateLayout()

E/AndroidRuntime(24914): FATAL EXCEPTION: main
E/AndroidRuntime(24914): Process: com.fsck.k9, PID: 24914
E/AndroidRuntime(24914): java.lang.NullPointerException
E/AndroidRuntime(24914):    at org.openintents.openpgp.util.OpenPgpServiceConnection.<init>(OpenPgpServiceConnection.java:35)
E/AndroidRuntime(24914):    at com.fsck.k9.view.MessageOpenPgpView.updateLayout(MessageOpenPgpView.java:115)
E/AndroidRuntime(24914):    at com.fsck.k9.view.SingleMessageView.setMessage(SingleMessageView.java:623)
E/AndroidRuntime(24914):    at com.fsck.k9.fragment.MessageViewFragment$Listener$2.run(MessageViewFragment.java:602)
E/AndroidRuntime(24914):    at android.os.Handler.handleCallback(Handler.java:733)
E/AndroidRuntime(24914):    at android.os.Handler.dispatchMessage(Handler.java:95)
E/AndroidRuntime(24914):    at android.os.Looper.loop(Looper.java:136)
E/AndroidRuntime(24914):    at android.app.ActivityThread.main(ActivityThread.java:5081)
E/AndroidRuntime(24914):    at java.lang.reflect.Method.invokeNative(Native Method)
E/AndroidRuntime(24914):    at java.lang.reflect.Method.invoke(Method.java:515)
E/AndroidRuntime(24914):    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:791)
E/AndroidRuntime(24914):    at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:607)
E/AndroidRuntime(24914):    at dalvik.system.NativeStart.main(Native Method)
"
"58efee8be21f2c21b1cf2db34e15cf9d163fcbed","2014-04-25 18:03:27-04:00","Avoid StrictMode error in OpenPgpApi

E/StrictMode(9278): A resource was acquired at attached stack trace but never released. See java.io.Closeable for information on avoiding resource leaks.
E/StrictMode(9278): java.lang.Throwable: Explicit termination method 'close' not called
E/StrictMode(9278): 	at dalvik.system.CloseGuard.open(CloseGuard.java:184)
E/StrictMode(9278): 	at android.os.ParcelFileDescriptor.<init>(ParcelFileDescriptor.java:179)
E/StrictMode(9278): 	at android.os.ParcelFileDescriptor.<init>(ParcelFileDescriptor.java:168)
E/StrictMode(9278): 	at android.os.ParcelFileDescriptor.createPipe(ParcelFileDescriptor.java:362)
E/StrictMode(9278): 	at org.openintents.openpgp.util.ParcelFileDescriptorUtil.pipeFrom(ParcelFileDescriptorUtil.java:34)
E/StrictMode(9278): 	at org.openintents.openpgp.util.OpenPgpApi.executeApi(OpenPgpApi.java:222)
E/StrictMode(9278): 	at org.openintents.openpgp.util.OpenPgpApi$OpenPgpAsyncTask.doInBackground(OpenPgpApi.java:189)
E/StrictMode(9278): 	at org.openintents.openpgp.util.OpenPgpApi$OpenPgpAsyncTask.doInBackground(OpenPgpApi.java:1)
E/StrictMode(9278): 	at android.os.AsyncTask$2.call(AsyncTask.java:288)
E/StrictMode(9278): 	at java.util.concurrent.FutureTask.run(FutureTask.java:237)
E/StrictMode(9278): 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1112)
E/StrictMode(9278): 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:587)
E/StrictMode(9278): 	at java.lang.Thread.run(Thread.java:841)
"
"523180020caee56525c1c0e16c92fbcd8750e9c9","2014-05-03 10:58:44-04:00","Don't use enum ordinal as array index, v. 2

This revises commit 51aa34d per the GitHub comments therewith.
"
"00a60a0f4f53e650e3de1a580f9ab69706e6a3fb","2014-05-03 12:51:37-04:00","Clean up lint items

Eliminate unused variables/fields/imports
"
"ed3fcf375af21f8b03f3718d3db629135d4c3042","2014-05-03 12:58:46-04:00","Eliminate unused variable & redundant call

There are no side effects.

The subsequent executeOpenPgpMethod() calls
getOpenPgpInputStream() which calls
buildText(false)
"
"95f33c38fe76da020be3fe85af61503622ee2fae","2014-05-04 03:54:10+02:00","Merge pull request #468

Extract a TextBodyBuilder class

Conflicts:
src/com/fsck/k9/activity/MessageCompose.java
"
"082e13df2663363744f2b05083eb92c6cac9029e","2014-05-18 02:05:52+02:00","Add support for delete confirmation in message list

Fixes issue 6260
"
"2fdcb77c5c24b2443a74e4e516c80a9d0973639f","2014-05-22 12:46:28+02:00","Merge pull request #470 from k9mail/issue_6260_delete_confirmation_in_message_list

Add support for delete confirmation in message list
"
"7ac7fe2cfecbbd93e1150df10fb4cee69c11d6db","2014-05-26 14:56:28-07:00","Issue 3559: Use From or ReplyTo hostname in Message-ID if available.

I wrote this fix to avoid obviously specifying that I am using a mobile device
to reply to an email.

Others want this for ease of filtering messages from their host by Message-ID.
"
"87802a01efc47be76bab7b1d89eb8c184d754995","2014-05-26 14:57:25-07:00","Issue 4690: Add privacy pref to omit K-9 User-Agent header.
"
"38c90146e1f57f4f505b2c2ec9be33d0b0145fef","2014-05-26 17:14:07-07:00","Issue 6372: Add preference for setting timezone to UTC.

This is a privacy preference to avoid leaking your current location while
replying to email.
"
"aad171ff7ecf8405d4e0841ae384e07b445cfe33","2014-05-25 22:45:14+02:00","Client Certificate Authentication
"
"d67a59b77fd84a1f9c5b332b8f6d9f9bbd2d7a0a","2014-06-13 17:38:48-07:00","Fixes for cketti's code review on pull req #472

Leave the hostname == null checks so we can fall back if a hostname is not
found. Also convert message-id to upper case to match Apple Mail (for
privacy).
"
"59bda357e042c58ec4352c06c679fb077e63cfdd","2014-06-14 03:02:49+02:00","Merge pull request #472 from mikeperry-tor/improve-header-privacy

Improve header privacy (Issues 6372, 3559, and 4690)
"
"324db5656946b507404478c741ade9300ab78d7d","2014-06-14 03:29:22+02:00","Use latest Gradle Android plugin and build tools
"
"103f85aa01756fccd9a308244ac228a39a98c0f4","2014-06-21 15:33:45+02:00","Fix 'testsOnJVM' Gradle task
"
"ba69b3a647d162f36afe3cd741b307c16eb8dcc8","2014-06-21 16:54:09+02:00","Remove ActionBarSherlock
"
"750e4a780838d632779e404773f1e52324ddd061","2014-06-22 11:03:22+09:00","Updated Japanese translation of the changelog.
"
"731da2747ef57f06a83a55da3afe5f78a1646d78","2014-06-28 03:41:23+02:00","Merge pull request #476 from k9mail/remove_actionbarsherlock

Remove ActionBarSherlock
"
"3142a9a225854e2f2b3a92d04c3f09b32ed64670","2014-07-04 18:08:07-04:00","Merge branch 'master' into tls-client-cert-auth

Conflicts:
src/com/fsck/k9/fragment/ConfirmationDialogFragment.java
"
"cf718780f6bcb0afa8166921219c54923b17d8d3","2014-07-04 19:23:43-04:00","Fixes needed after merging in master

Also, fix unit tests.
"
"acd756e642dbad58bea86eb5160e0d7f3f3124cc","2014-07-05 18:59:48+02:00","Fixed https://github.com/typingArtist/k-9/issues/1. HELO/EHLO IPv6 address literals
are now conforming to RFC5321.
"
"0a507463c4eca5023eb6dd1e7d78f74390c35135","2014-07-05 13:12:38-04:00","Merge pull request #478 from typingArtist/master

Fix: HELO/EHLO with literal IPv6 address not conformant to RFC5321
verified in spec – ashleywillis
"
"008891a375250e2de420d2fa9983a1e161b4ee2c","2014-07-13 01:09:23-04:00","Clean up indentation

White space changes only.
"
"3c025379d404378fdc9932d60135787aaad5b102","2014-07-13 02:41:58-04:00","Rework validateFields() and updateViewFromAuthType()

Previously, it was possible to have 'Require sign-in' unchecked and a
'Security = None' setting for the outgoing server and still not be able to
tap 'Next' because of a hidden (and irrelevant) 'Authentication = Client
certificate' setting.

Check that the user has actually chosen a client certificate in
AccountSetupOutgoing.validateFields().

Also, there's no need to clear the password and certificate fields when
hiding them.  The user may accidentally change settings and want to change
them back without wiping out the existing settings.
"
"14032088db44ffb751b5ebab38919e6671a4afc5","2014-07-19 15:22:51+01:00","Update providers.xml

Added apple mail providers (apple.com, mac.com, me.com, icloud.com)
"
"2486caaf2dbd32cbd67a2ed45ee2c7448349664e","2014-07-19 15:46:11+01:00","Sort apple emails in own category and add icloud.com
"
"a671e51052d9313a788c4ad04cfeb2f17886e9fc","2014-07-19 15:48:44+01:00","Sort apple emails in own category and add icloud.com
"
"f463aa9fa0c4564dbfc12236e3d0f4dd732ec457","2014-07-26 16:53:03+02:00","Fix indentation
"
"96be55a262513d9537d29c5d1ee6764d38e83a5d","2014-07-26 16:56:47+02:00","Merge pull request #481

Sort apple emails in own category, add apple.com and icloud.com
"
"c36d2d7a5e5b27f7cfd6892109f9ceb5e49006df","2014-07-26 18:06:20+02:00","Use latest Gradle Android plugin and build tools
"
"710e7a443025346253508d280b110b89a282b8c8","2014-07-13 14:08:24-04:00","Notify user of invalid account-setup settings combo

Specifically, warn and block them when attempting to configure Client
Certificate Authentication in combination with Connection Security = None.

If this were not made obvious to the user, they might not understand why
they are not permitted to tap 'Next'.

Also, move the initialization of all view listeners out of onCreate() into
initializeViewListeners() which is then called near the end of onCreate(),
helping to assure that the listeners won't be triggered during the
initialization of views inside onCreate().
"
"fe49a5f005b8b6f535db9227d9b6a24b45212b46","2014-06-18 11:38:01-04:00","Avoid NPE in MessageOpenPgpView.handleError()

E/AndroidRuntime(25655): FATAL EXCEPTION: main
E/AndroidRuntime(25655): Process: com.fsck.k9, PID: 25655
E/AndroidRuntime(25655): java.lang.NullPointerException
E/AndroidRuntime(25655):     at com.fsck.k9.view.MessageOpenPgpView.handleError(MessageOpenPgpView.java:385)
E/AndroidRuntime(25655):     at com.fsck.k9.view.MessageOpenPgpView.access$3(MessageOpenPgpView.java:384)
E/AndroidRuntime(25655):     at com.fsck.k9.view.MessageOpenPgpView$DecryptVerifyCallback.onReturn(MessageOpenPgpView.java:357)
E/AndroidRuntime(25655):     at org.openintents.openpgp.util.OpenPgpApi$OpenPgpAsyncTask.onPostExecute(OpenPgpApi.java:195)
E/AndroidRuntime(25655):     at org.openintents.openpgp.util.OpenPgpApi$OpenPgpAsyncTask.onPostExecute(OpenPgpApi.java:1)
E/AndroidRuntime(25655):     at android.os.AsyncTask.finish(AsyncTask.java:632)
E/AndroidRuntime(25655):     at android.os.AsyncTask.access$600(AsyncTask.java:177)
E/AndroidRuntime(25655):     at android.os.AsyncTask$InternalHandler.handleMessage(AsyncTask.java:645)
E/AndroidRuntime(25655):     at android.os.Handler.dispatchMessage(Handler.java:102)
E/AndroidRuntime(25655):     at android.os.Looper.loop(Looper.java:136)
E/AndroidRuntime(25655):     at android.app.ActivityThread.main(ActivityThread.java:5128)
E/AndroidRuntime(25655):     at java.lang.reflect.Method.invokeNative(Native Method)
E/AndroidRuntime(25655):     at java.lang.reflect.Method.invoke(Method.java:515)
E/AndroidRuntime(25655):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:795)
E/AndroidRuntime(25655):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:611)
E/AndroidRuntime(25655):     at dalvik.system.NativeStart.main(Native Method)
"
"41570e4305469218fe1357a748beac8991ce133c","2014-07-15 12:16:05-04:00","Fix leaked window error in FolderList

Observed after wiping data and then tapping a launcher shortcut
for an account.
"
"7aa4c1308e4e17844d81a85485a0e03d619962b6","2014-08-06 11:04:07+02:00","Configure mail notifications by folder class

In response to Issue 1794,
- add a configuration option in the account preferences to show
notifications only for 1st/2nd/etc class folders
- add an option in the folder preferences to set the notification class
as 1st, 2nd or inherited from the folder's push class

The default behaviour remains unchanged.
"
"51829a2451ec80e156d5afcef49b6570238976c7","2014-07-13 15:00:49-04:00","Reorganize the server setup layouts

This only changes the vertical display order of the widgets.

The user will likely review the settings from top to bottom, but
the way they were previously arranged, settings lower on the list
were affecting things higher on the list.

Generally show top to bottom:
Server
security type
port (affected by security type above)
require login checkbox (SMTP only, affects everything below)
user
auth. type (affected by security type above, affects everything below)
password (affected by auth. type above)
client cert (affected by auth. type above)
"
"ada74db8d51e66dac11e1c6da752ca42478f518d","2014-07-14 17:59:07-04:00","Refactor KeyChainKeyManager()'s sClientCertificateReferenceWorkaround

The referenced issue states that it is only applicable to Android < 4.2
(testing confirms the problem on 4.1.2, but not on 4.2.2).

A test was added for the version code, primarily as a finder's aid for a
day when K-9 Mail no longer supports Android < 4.2 and the work-around can
be removed.

The referenced issue also states that it is only necessary to hold a
reference to the first PrivateKey retrieved. (Testing indicates that the
problem is avoided so long at least one reference is always maintained to
a PrivateKey -- it doesn't actually need to be a continuous reference to
the first PrivateKey.)

From my understanding, a normal class loader never unloads a class, so the
static reference can be safely kept privately in KeyChainKeyManager.
"
"34fd6d3ea7c7faf6e1f076b3a899ed9c6a648d18","2014-07-13 17:00:13-04:00","Import/Export client certificate alias setting
"
"eb68bc0a9da6ebce2ab36f20e62e538ae1198ed5","2014-07-14 11:19:09-04:00","Avoid NPE on export

Occurs when the SMTP server doesn't require authentication
(authenticationType == null).

The javadoc for ServerSettings says that both authenticationType and
connectionSecurity may be null.
"
"bef10812d3ebe49a87188271baa0744343dd356c","2014-07-14 13:54:13-04:00","Fix so WebDAV does not have STARTTLS auth. type option
"
"6d8497a3c3c5b68006b0d5da59c91f6509ae6cf4","2014-07-14 17:32:28-04:00","Fix WebDAV manual account setup

When creating a new account, the Incoming Server Settings screen
was initialized with the user name = PLAIN.
"
"373c7569edf6a222f5092378c8d1fe53c2b48c9d","2014-07-14 20:47:26-04:00","Fix password prompts on account import

Don't prompt if server's AuthType == EXTERNAL

Don't prompt for SMTP servers that don't require authentication
(no user name).
"
"c861b27df81628ceb417037a8f69ab4f65f083c0","2014-07-15 10:57:57-04:00","Fix outgoing server settings display

Add test for username == ''.

Without it, the mRequireLoginView remains checked, and the empty username
and password boxes are not hidden.

The problem occurs if importing an SMTP server that has an
authenticationType, but no username or password (i.e., no authentication
required).

That's the way settings were exported in 4.904 and before.
"
"2e981e0c7d55a46162ad1ee896278dd16f1e8a43","2014-07-16 19:45:48-04:00","Don't trigger validateFields() except on user input

Previously, with settings of Security=SSL and authentication=certificate,
attempting to change Security=None would (of course) be blocked.  So
Security would remain SSL.  But the authentication options would then
include 'Password, transmitted insecurely', whereas the option should
have remained as 'Normal password' (because the security remained SSL).

The problem could have been fixed with a simple shuffling in
updatePortFromSecurityType() so that updateAuthPlainTextFromSecurityType()
was invoked before mPortView.setText(), but the logic for requiring that
ordering was not plain to see.  (Although no longer necessary, the
shuffling was done as well.)
"
"acab554ee5b56682a8daabc5f677c0e1597deabc","2014-07-17 11:36:54-04:00","Save/Restore activity state

This assures that changes made to the port setting and to the chosen
client certificate are saved and restored.
"
"38e9af5320ff424178699003369f690181cfbb68","2014-07-17 11:58:46-04:00","Don't clear widgets when removing

The user may toggle the checkbox, and then decide to toggle it again.

This also fixes a problem when restoring the activity state.  When the
checkbox was restored as checked, the listener was firing and wiping the
the restored alias.
"
"88016ae52efa78666288ca6b5f95bc53d6d303c5","2014-07-18 12:39:11-04:00","Revert unused code changes
"
"0224a891096099e192fa045336d460de0d1502c7","2014-07-19 16:54:54-04:00","Use theme based style
"
"b10b13b865ebacbd22ec512cd0738dc09371adb8","2014-07-19 17:23:38-04:00","Force manual setup if using client certificates

Presently, auto-setup doesn't support certificates,
resulting in 'Cannot connect to server. (Error
while decoding store URI)'.
"
"fa853f7e1d6f006d243855f90e9837225bf6b3ef","2014-07-19 20:35:18-04:00","Remove SslHelper.isClientCertificateSupportAvailable()

The app's minSdkVersion = 15 (Android 4.0.3, Ice Cream Sandwich MR1),
so there's no need to test the API level.

This also removes '@SuppressLint('TrulyRandom')'.  I find no
documentation for it, nor do I find any additional lint errors
with its removal.
"
"21cc3d9176b31d47d642a3c424bb00d1966b9e4c","2014-07-21 19:18:16-04:00","Remove ClientCertificateRequiredException

With this commit, KeyChainKeyManager no longer throws the exception and
AccountSetupCheckSettings no longer catches it.

It was being thrown when the server requested a client certificate but no
client certificate alias had been configured for the server.

The code was making the incorrect assumption that the server would only
request a client certificate when such a certificate was *required*.
However, servers can be configured to accept multiple forms of
authentication, including both password authentication and client
certificate authentication.  So a server may request a certificate without
requiring it.  If a user has not configured a client certificate, then
that should not be treated as an error because the configuration may be
valid and the server may accept it.

The only indication that a certificate is *required* is when a
SSLProtocolException is thrown, caused by a SSLHandshakeException
resulting from a fatal handshake alert message received from the server.
Unfortunately, such a message is fairly generic and only 'indicates that
the sender was unable to negotiate an acceptable set of security
parameters given the options available.'  So there is no definitive way to
know that a client certificate is required.

Also, KeyChainKeyManager.getCertificateChain() and getPrivateKey() no
longer throw IllegalStateException().  These methods are permitted to
return null, and such a response is appropriate if the user has deleted
client certificates from the device.  Again, this may or may not cause the
server to abort the connection, depending on whether the server *requires*
a client certificate.
"
"231f3645f9684374ed177d95d4053038c2ddde72","2014-07-23 15:25:50-04:00","Trigger certificate chooser on authentication change

If the user chooses client certificate authentication,
immediately pop up the certificate chooser.

If the user chooses password authentication, move the focus to the
password View.
"
"65144e37599db05538bb6c6cb44658f46bb9d482","2014-07-25 09:13:59-04:00","Handle client certificate errors

If the alias is empty or null, don't bother using KeyChainKeyManager.

If the alias is not empty, confirm that it is associated with a
certificate, otherwise throw a CertificateValidationException
which will notify the user of the problem and ask the user to
check the server settings.

Likewise, the user is notified if the client certificate was
not accepted by the server.
"
"fe033e014f3a9009daf3d2fd6bdcfc1e9ca20072","2014-07-25 18:05:16-04:00","Avoid setting conflict warning when SMTP login not required
"
"c0be0eea126e63ee41eea2fd8096d16b55de8db6","2014-07-26 12:56:56-04:00","Use the correct POP3 AUTH command
"
"b557ba008cb13a9ccd02405c10f8745c23761ca0","2014-07-26 13:35:19-04:00","Implement SMTP AUTH EXTERNAL

Also, simplify by using Utility.base64Encode(String) in lieu of
new String(Base64.encodeBase64(String.getBytes())
"
"301ac48a38fb6af36e218d53c97ffcdbbfa8b179","2014-08-07 13:54:14-04:00","Throw CertificateValidationException if EXTERNAL authentication fails

This is done when the SASL EXTERNAL mechanism isn't advertised (indicating
the possibility that the server did not accept the client certificate) or
when the command for authenticating with SASL EXTERNAL fails.

The CertificateValidationException will trigger a notification to the user
that there's an authentication problem that needs addressing.

Also, there were instances where CertificateValidationException was being
thrown with a new CertificateException as the cause for the purpose of
notifying the user when STARTTLS is not available.  This has been slightly
simplified by eliminating the need to include a new CertificateException
as a cause.
"
"cf3561da5cb9a15fca4bc13c2c1b003b1b10b0e0","2014-07-27 00:59:28-04:00","Trigger certificate chooser when check box checked

For convenience.  Implemented in onCheckChanged().

As a consequence, onCheckChanged() must not be triggered when the instance
state is restored (would occur if the check box state was checked when
saved), otherwise the certificate chooser would pop up once the state was
restored.  Therefore, all listeners have been moved into
initializeViewListeners() which is invoked after the state has been
restored.

Because onCheckChanged() is no longer triggered in
onRestoreInstanceState(), updateViewVisibility() was implemented to
restore the view visibility.
"
"5d5fab308182fa2eb9431c5e49ef1474ca9279c0","2014-07-28 12:56:01-04:00","Fix default port setting reversion

The problem:  begin modifying the server settings by changing the security
type (which will change the port to a default value), then change the port
to a custom value, then change screen orientation.  The default port value
is restored, wiping out the custom value.

When onRestoreInstanceState() is called, the custom port value is
restored.  But the spinner doesn't actually restore its state at that
time.  Instead, it waits until View.layout(), at which time it posts a
runnable to call onItemSelected() if the restored state doesn't match the
state initialized in onCreate().  When onItemSelected() is eventually run
sometime later, it wipes out the custom port value that was restored.

The solution is to keep track of the spinner state ourselves and only
revert the port to a default when we see the spinner state changed by the
user.

This problem goes back to 4.904 and before.
"
"346d903ec382557528589d426b6d4576f608311c","2014-07-28 15:29:44-04:00","Only trigger certificate chooser on user input

It should not be triggered when the instance state is restored
with an AuthType spinner selection of EXTERNAL.

The logic here for the AuthType spinner is similar to that of
the parent commit for the SecurityType spinner.
"
"c5085be2cab7989ab79d70ce2f1211674783205d","2014-07-30 10:52:01-04:00","Restore view visibility based on restored CheckBox state

The problem can be observed if, when modifying the outgoing server
settings, you change the state of the mRequireLoginView check box,
then change the screen orientation.

This is necessary because the OnCheckChanged listener (which
normally updates the view visibility) is not yet set. (The listeners
are set up after view initialization so that they only fire on
user input.)
"
"2b05f90d4df8ef7902c9ea31afa15d649c1f64a5","2014-08-05 10:15:54-04:00","Move KeyChainKeyManager

Move KeyChainKeyManager to com.fsck.k9.net.ssl because it is used by
SslHelper and because the class extends X509ExtendedKeyManager, which is
in javax.net.ssl.
"
"21237c37204541960bec596bed5fe105e010b157","2014-08-05 15:00:33-04:00","KeyChainKeyManager modifications

The constructor now saves the certificate chain, so the code to retrieve
it again or to perform any additional error checking in
getCertificateChain() is no longer needed.

The constructor now retrieves and saves the private key so that any
resulting errors are detected sooner.

Methods that retrieve the alias perform checks to assure that the client
cert. satisfies the requested issuers and key type.  It's known that
Sendmail may provide a list of issuers in its certificate request, but
then may authenticate against a much larger set of CAs, but then later
reject the mail because the client certificate was not acceptable.
Vetting against the issuer list helps detect such certificate problems
sooner (upon connection) rather than later (upon transmission of mail).
Earlier error detection is necessary so that errors may be presented to
the user during account setup.

Portions of these modifications are based on code from KeyManagerImpl:
https://android.googlesource.com/platform/external/conscrypt/+/master/src/main/java/org/conscrypt/KeyManagerImpl.java
"
"c8f6c4d62578973ca6bc2360e333a83aae9e5edf","2014-08-07 17:00:54-04:00","Eliminate searching for '3' in exception message

This was dead code.  The exception message will always start with either
'SMTP response is 0 length' from checkLine() or else 'Negative SMTP reply'
from NegativeSmtpReplyException().

The problem originated from way back before 4.904.
"
"c881207295179b04b0fd1bed1b682f6d94c3cfe6","2014-08-14 16:22:51-04:00","Use isFinishing() instead

As suggested by @maniac103
https://github.com/k9mail/k-9/commit/41570e4#commitcomment-7388209
"
"4ce2a56b0c8fb41a5ddca3ce1ef7efefecafb269","2014-08-18 04:33:56+02:00","Synchronize access to sClientCertificateReferenceWorkaround

Also, refactor for easier readability.
"
"ac08f520ae7f69d343b5338b7abd27e9188d34de","2014-08-18 05:08:01+02:00","Remove KeyChainKeyManager's dependency on 'K9.app'
"
"a659393326483191302a7cd48789d2ab311b09a0","2014-08-18 05:18:38+02:00","Make fields in KeyChainKeyManager final
"
"a495627d72990f0ce6cb795d5e2d9dae3df523fe","2014-08-18 13:06:25+02:00","Show password feature
"
"3bd9e7edf1abd15054f6fd1675ea1d963efeafa2","2014-08-18 22:30:06+02:00","Merge pull request #490 from pylerSM/master

Add 'Show password' check box to account setup screen
"
"f7fb0cca4187270e20bc637962ac4cdb25c3f5d8","2014-08-18 18:12:39-04:00","Compare Enum types with ==, !=

Per comments in PR #473

https://github.com/k9mail/k-9/pull/474#commitcomment-7416979

https://github.com/k9mail/k-9/pull/474#commitcomment-7416999
"
"b39f9b95f101ea378bfd697d722ade192cc2aa0e","2014-08-18 18:15:17-04:00","Move initializeViewListeners() to onPostCreate()

Per comments in PR #474

https://github.com/k9mail/k-9/pull/474#commitcomment-7417262
"
"1783dd1a632ca61855a11776a341b11f0019bdac","2014-08-19 16:19:02-04:00","Merge branch 'master' into tls-client-cert-auth

Conflicts:
res/layout/account_setup_basics.xml
res/values/strings.xml
src/com/fsck/k9/activity/setup/AccountSetupBasics.java
"
"c472b89d2302bc93d599324f538d298d4b82be93","2014-08-18 18:44:34-04:00","Additional 'Show password' changes after merging master
"
"af77bbd1bce2a2014af7dbd4f3de21750cc29466","2014-03-14 12:47:41-04:00","Eliminate obsolete background data sync option

It only applied to pre-ICS devices.

ConnectivityManager.ACTION_BACKGROUND_DATA_SETTING_CHANGED is no longer
broadcast.

ConnectivityManager.getBackgroundDataSetting() always returns true.
"
"8166f03e87ac1274fbd76e341ddb0abccd21403b","2014-08-16 19:39:18-04:00","Remove obsolete 'Show unread count' preference

Only applies to pre-Honeycomb devices
"
"0fba273357c630067794ebcac0af71bbe4f12c30","2014-08-16 20:03:22-04:00","Remove the obsolete 'Condensed layout' preference
"
"028f6f905569057875bf950274850f2b043607ce","2014-08-16 20:17:08-04:00","Remove AccessibleWebView

Only used on pre-ICS devices
"
"786511ed88dbbd52b6f151a84a7e2f70219a9464","2014-08-16 20:24:54-04:00","Simplify ClipboardManager

No longer API dependent.
"
"bc60c860b84cde7e71c07fd14967aed37c4a2e38","2014-08-16 20:33:26-04:00","Remove com.fsck.k9.helper.NotificationBuilder

Only useful on pre-Honeycomb devices.
"
"e4d26b8c752f03dc8a40bcb59a0e601835205083","2014-08-16 18:59:50-04:00","Remove code for unsupported API levels

An assortment of miscellaneous changes, each usually limited in scope to a
single file.
"
"2a1733564e3e13295d60e97d8d82b99693496d2e","2014-08-27 11:30:53+02:00","Add FoldableLinearLayout for advanced options
"
"05d8fb5e42a8dccdb26e868fb7642fba1102457c","2014-08-27 11:48:49+02:00","Hide client cert option under advanced options dropdown
"
"ac1ed9eef309ddde3eaf138152e0393854a885ba","2014-08-29 01:45:48+02:00","Increment settings version
"
"0993e5c57e060aa0e24b729f5243f776af2a30c2","2014-08-29 01:55:22+02:00","Merge branch 'remove_obsolete_code'

PR #491 from zjw
"
"1282e9d46106ad7b643f570b33a685b1feef1eec","2014-08-29 02:41:50+02:00","Remove ldpi resources
"
"c2db88d960ead2ca863d63e9618ee0eb0ca614ac","2014-08-29 03:43:31+02:00","Add top margin to the 'advanced options' area
"
"c80634d50125e9284b2cddd8f76bb8bdf7dee6e7","2014-08-21 09:58:27-04:00","Format log messages with spaces
"
"348fb4dceb7e0efe56eff35e9e2a5e04b899c225","2014-08-27 16:23:26-04:00","Validate client certificate dates
"
"a756fa3683366bdc56e32f2691c532df85d333ca","2014-08-28 17:46:56-04:00","Use Theme consistent styles in FoldableLinearLayout

For support of the dark and light themes.

Also:

Redefine mFolded and call it mIsFolded.  Previously,
the view started with mFolded = false (which implies to me
the initial state is unfolded) and yet the view
started in a folded state, which seemed contradictory.

Create updateFoldedState() with code from onClick() (In
preparation for subsequent commit.)
"
"8ade4242708f7ea8d1518126510dfd9c11219aa8","2014-08-28 17:48:37-04:00","Save/Restore the FoldableLinearLayout state
"
"9728609c4c7c5f5a448b6a31d135e843de75593f","2014-08-29 10:17:57-04:00","Make the foldable container view INVISIBLE, not GONE

Now when toggling the foldable view, the screen no longer
jumps half a line up or down to recenter itself when
the view is displayed.
"
"7c4a684f86434e08d3c5bc9cccb0a62f85493fe8","2014-08-29 10:24:24-04:00","Clean up indentation

White space changes only
"
"759fa77c9a9938e55dbe8a3a0fcd5599799aa806","2014-08-30 01:06:28+02:00","Merge pull request #474 from k9mail/tls-client-cert-auth

Client Certificate Authentication
"
"0c38d4f1699a46474aa76dce93418859f0f03e69","2014-08-29 02:54:08+02:00","Remove unused resources and merge resource folders
"
"ae8dcc5e8a8c395445a82925949ab465f619b248","2014-08-29 03:03:23+02:00","Fix typo in attribute name
"
"cb67a21a9311d3c31f31c34bc74e7f45deae1eb1","2014-09-04 21:58:18+02:00","Remove commented-out code
"
"bd9efa8d01a1127069b33190d270a013fde14259","2014-09-04 22:35:03+02:00","Whitespace fixes
"
"8ef45e8f9afd48cf17ebeeb446461d42caa6b1cc","2014-09-04 17:01:28-04:00","Merge pull request #492 from k9mail/remove_unused_resources

Resources cleanup
"
"7edd1cb53cc2a0abbd08ac70ad5494076588ccd8","2014-09-04 22:48:13+02:00","Simplify database upgrade when adding 'notify_class' to 'folders'
"
"5802e6a36aeea8a27170f494d26a782c497d12a6","2014-09-04 22:56:29+02:00","Remove getNotifyClass() from Folder
"
"f5cfaceef4ade2ae711795ceeb476e99570d82c7","2014-09-04 23:00:29+02:00","Increase settings version in preparation of merge into master
"
"5f0f4e9c219a364c8669cc02fb0a2ae0410b39bc","2014-09-04 23:55:30+02:00","Merge pull request #485 from haselwarter

Conflicts:
src/com/fsck/k9/preferences/Settings.java
"
"6f14294164b94d25fa00038a5c2d544ddf195b4e","2014-08-21 16:16:19-04:00","Remove SslHelper.  Don't use SecureRandom.

SslHelper has been removed, and its functionality has been transferred
into TrustedSocketFactory.  The added layer of indirection wasn't really
simplifying anything.  It's now easier to see what happens when
createSocket() is invoked.

A new instance of SecureRandom is no longer passed to SSLContext.init().
Instead, null is passed.

The (default) provider of the TLS SSLContext used is OpenSSLProvider,
which provides an SSLSocket instance of type OpenSSLSocketImpl.  The only
use of SecureRandom is in OpenSSLSocketImpl.startHandshake(), where it is
used to seed the OpenSSL PRNG with additional random data.  But if
SecureRandom is null, then /dev/urandom is used for seeding instead.

Meanwhile, the default provider for the SecureRandom service is
OpenSSLRandom, which uses the OpenSSL PRNG as its data source.  So we were
effectively seeding the OpenSSL PRNG with itself.  That's probably okay
(we trust that the OpenSSL PRNG was properly initialized with random data
before first use), but using /dev/urandom would seem like a better source
(or at least as good a source) for the additional seed data added with
each new connection.

Note that our PRNGFixes class replaces the default SecureRandom service
with one whose data source is /dev/urandom for certain vulnerable API
levels anyway.  (It also makes sure that the OpenSSL PRNG is properly
seeded before first use for certain vulnerable API levels.)
"
"7dfbd906c92f280e9cce47389a2280d2064df15c","2014-08-22 10:02:45-04:00","Eliminate DomainNameChecker

There's no need to maintain our own implementation when comparable
classes already exist in the Android API.

StrictHostnameVerifier is used instead.
"
"43c38a047feedda4720af5bfbc188a33f8dfaced","2014-09-06 16:35:48-04:00","Implement SSL file-based session caching

Caching is beneficial because it can eliminate redundant cryptographic
computations and network traffic when re-establishing a connection to
the same server, thus saving time and conserving power.
"
"9e203b75ccdd0de87fbd3279966c0e694e9ded41","2014-09-07 23:08:40+02:00","Remove gallery bug work-around

This bug was present in the Gallery app shipped with Android 2.0.
The time has come to say good-bye. We will never forget you! But only because you're part of our Git history.
"
"5a6648ceeb8f2f85f8fae78f547dd0d3350ca1f2","2014-09-09 00:04:10+02:00","Update translations from Transifex

New languages:
- Latvian
- Estonian
- Norwegian Bokmål
- Galician (Spain)
"
"9911208441135314ed4a2986a8fc3e00295b0af2","2014-09-09 00:10:14+02:00","Ignore UnusedQuantity and MissingQuantity lint warnings for all translations
"
"2e318096b7583f04c91c8960c4edd69abed8e5ac","2014-09-09 00:59:56+02:00","Add new translations

Add new languages that were promised in commit 5a6648ceeb8f2f85f8fae78f547dd0d3350ca1f2:
- Latvian
- Estonian
- Norwegian Bokmål
- Galician (Spain)
"
"094feced0c04ca99f4c8c610ab0163015ba5b88e","2014-09-09 18:56:36-04:00","Remove unused imports
"
"59a61366caae65b2f9fbcbb51e3881da0439c94b","2014-09-09 18:59:18-04:00","Merge branch 'remove_gallery_bug_workaround'

Conflicts:
res/values-it/strings.xml
res/values-iw/strings.xml
res/values-sv/strings.xml
"
"a10b9ae452e657aeaf5fa9b10f8df03e51b6be26","2014-09-10 01:44:44+02:00","Merge pull request #493 from zjw/ssl_changes

SSL changes
"
"0f6719387c9615e8420e5724b9580299f23a2ef8","2014-09-10 11:34:37-04:00","Re-enable TLSv1.1/1.2 support

Was disabled in 3fd7470d.

Issue 6238.

Related Android change for API 20:
https://android.googlesource.com/platform/external/conscrypt/+/1f63d2c22326b989105366d2907a83b848dcd29e%5E!/
"
"47cedef85c915b5f2d013124dde0bfe021d66a09","2014-09-10 20:58:46+02:00","Update changelog for 4.905
"
"5ddfe4b58e1109708c9f17a614440e2abeb1ae0d","2014-09-10 21:12:12+02:00","Bumped manifest to 4.905
"
