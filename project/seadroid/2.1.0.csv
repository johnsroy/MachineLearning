"commit id","commit date","commit message"
"2050ca523584854da40eb3c240f7f6ecd93acc1c","2016-05-06 18:38:23+02:00","Fix typo
"
"09f74e2cf0984f0591257b332865580e50603592","2016-05-07 00:12:47+02:00","Fix app.seafile.de Server URL
"
"440090a1b9dffbe9ca7f66bb3de7aa0c3dd2809e","2016-05-07 10:11:23+08:00","Merge pull request #517 from shoeper/patch-1

Fix app.seafile.de Server URL
"
"c602e89dc00acb5c7320806e81d5c7d4253578ec","2016-05-07 10:27:43+08:00","Merge pull request #516 from Angristan/patch-1

Fix typo for french translation
"
"0dd40f6486ba6a5f70d946e52ce3075bee38b007","2016-05-07 10:25:01+08:00","Update server address
"
"ba6b1ad510da171b8230a21583b4e065df68e949","2016-05-07 10:27:12+08:00","Update build.gradle
"
"2643b79b3410997e608eec44284af3e4e7adfd73","2016-05-07 10:35:04+08:00","Update i18n
"
"a0d20907db6b3c5baa3cbd1a2af1b1ed0a968574","2016-05-07 13:29:20+08:00","Fix open markdown file failed bug
"
"5ea272bc1066d97d247e90aa977671ac82db9809","2016-05-07 15:21:31+08:00","Using  GB/MB/KB instead of GiB/MiB/KiB to show Quota and file size (1GB = 1000MB = 1,000,000KB)
"
"5573fd4228dcbf5e7d35bbccfc5e99882e5f80a3","2016-05-07 16:07:03+08:00","Deleted unused libraries and depedent MarkdownView in gradle buid manner
"
"c940f28ed122cb6ffd4632c05a6c30ea93b601b1","2016-05-07 14:27:49+08:00","Support package debug version
"
"78b270a4106cde7096315f1cf38575b2f386113d","2016-02-16 18:44:57+08:00","Support client side encryption

When you create an encrypted library, you'll provide a password for it. All the data in that library will be encrypted with the password before uploading to the server.

The encryption procedure is:

1. Generate a 32-byte long cryptographically strong random number. This will be used as the file encryption key ('file key').
2. Encrypt the file key with the user provided password. We first use PBKDF2 algorithm (1000 iteratioins of SHA256) to derive a key/iv pair from the password, then use AES 256/CBC to encrypt the file key. The result is called the 'encrypted file key'. This encrypted file key will be sent to and stored on the server. When you need to access the data, you can decrypt the file key from the encrypted file key.
3. All file data is encrypted by the file key with AES 256/CBC. We use PBKDF2 algorithm (1000 iterations of SHA256) to derive key/iv pair from the file key. After encryption, the data is uploaded to the server.
4. When you create the library, a 'magic token' is derived from the password and library id. This token is stored with the library on the server side. The client use this token to check whether your password is correct before you sync the library. The magic token is generated by PBKDF2 algorithm with 1000 iterations of SHA256 hash. You should check password validation before encryption.
5. For maximum security, the plain-text password won't be saved on the client side too. The client only saves the key/iv pair derived from the 'file key', which is used to decrypt the data. So if you forget the password, you won't be able to recover it or access your data on the server.

Useful links

1. Advanced password security using PBKDF2WithHmacSHA1 algorithm
http://howtodoinjava.com/security/how-to-generate-secure-password-hash-md5-sha-pbkdf2-bcrypt-examples/
2. Using Password-based Encryption on Android
http://nelenkov.blogspot.jp/2012/04/using-password-based-encryption-on.html
3. How does an encrypted library work?
http://manual.seafile.com/security/security_features.html

Related project

1. https://github.com/haiwen/seafile/blob/master/common/seafile-crypt.c
2. https://github.com/nelenkov/android-pbe/blob/master/src/org/nick/androidpbe/Crypto.java
3. https://github.com/haiwen/seafile-iOS/blob/master/common/NSData+Encryption.m
"
"b520428e1d4c2b9ae00d14a1aa8b1987f5972794","2016-02-17 15:17:10+08:00","Validate user input password by recompute the magic and compare it with the one comes with the repo

Bouncy Castle doesn't support PBKDF2WithHmacSHA256 by default, so use PKCS5S2ParametersGenerator with SHA256Digest instead.
That depends on Bouncy Castle jars, which could be downloaded in http://rtyley.github.io/spongycastle/#downloads

If you use version 1.47 or higher of SpongyCastle, you can invoke PBKDF2WithHmacSHA256 directly.
In versions of BC < 1.47, you could not specify SHA256 digest and it defaulted to SHA1

When using gradle, just specify your dependencies in build.gradle, that what this patch has done.

useful links
http://stackoverflow.com/questions/6898801/how-to-include-the-spongy-castle-jar-in-android
http://stackoverflow.com/questions/35472403/why-pbkdf2-sha256-generated-hash-value-not-equal-between-c-and-java
"
"ae123ff49aaa43f7e115b840d0010e34f937b2fe","2016-02-18 14:36:46+08:00","Add new parameter 'randomKey'
"
"d4ce49a4b7c6aca7fd5424dbd243555613c2aded","2016-02-18 14:37:45+08:00","Decrypt the key, iv from the encrypted file key (random key)

1. 'encrypted file key' is also called random key
2. to get a real secret key, we decrypt random key by password
3. use the real secret key to gerate a encKey and iv, in order to decrypt or encrypt data
4. cache encKey and iv from step 3 for later use and performance improvement
"
"0480bab950f2b7e220b78463627e30f4d5139ce3","2016-03-05 10:09:51+08:00","Use encKey instead of password to open the encrypted repo
"
"514c1172d0a5497107fe11c3f4c7ba9082981243","2016-03-06 16:19:08+08:00","Split file into chunks and transfer by blocks

useful links
1. http://stackoverflow.com/a/22803149/3962551
2. https://github.com/haiwen/seafile-docs/blob/master/develop/web_api.md#get-upload-blocks-link
3. https://github.com/haiwen/seafile-docs/blob/master/develop/web_api.md#get-update-blocks-link
"
"25249612e4733d0610326057a11dd138ab6cb58e","2016-03-11 23:20:20+08:00","Update gradle configurations
"
"78afd6cbc64887f3adc5ed315cfc9ac0f212d7ba","2016-03-12 11:40:43+08:00","Refactor name and update comments
"
"666c33343c7add45c5423bba78a48f499b15c1c4","2016-03-12 11:42:30+08:00","Upload blocks with a formated multipart form-data

Parameters to generate token:

- op: ' 'update-blks-api'
- use_onetime: False

Firstly, chunk file into 2M blocks. Then get file server link from seahub

Seahub server URL: `/api2/repos/<repo_id>/upload-blks-link/`

Then upload all blocks to file server at the same time.

File server URL:  `http://server-address:8082/upload-blks-api/<token>`

Parameters to upload blocks:

- parent_dir: parent directpry path
- file_name: file name
- file_size: file size in bytes
- replace: whether overwrite file with the same name

The client sends the blocks with a POST request to the file server. The content of the request is in multipart form-data format.

useful links
1. https://tools.ietf.org/html/rfc1867
"
"29a71625f98cf68e6fefdf791d6805b7e6c8ab67","2016-04-10 06:32:48+08:00","Implement update/upload file blocks and notify transmission progress

Note that when uploading a file in blocks, set the parameter `replace` to 0 or simply ignore it,
and updating a file in blocks is much the same as uploading a file in blocks,
except that set the parameter replace to 1 when uploading blocks.
"
"e6379a3bdcbd2abbeb748e364d425a6450e87416","2016-04-11 18:49:50+08:00","Download a File in Blocks

1. First get file server link for downloading a block
2. Then download the block from file server
"
"b0ca8ecb577221f9ceb9cea74711e4695e29573e","2016-04-12 15:22:44+08:00","Improve code style
"
"922c224dccf894314dff43fb3d712ffb850e18bd","2016-04-23 10:32:52+08:00","Update algorithm
"
"fb512de0c4002199010cc0b4e894aee70101872d","2016-04-24 10:35:01+08:00","Improve code style
"
"2afbd70185e522cc80f8af3f4fd0d7bb0ac46a5e","2016-04-24 20:27:50+08:00","adapt encryption feature to other modules
"
"85a44762cc1dc7a309e5b0424ee299e6b1eb2282","2016-04-25 09:43:43+08:00","Improve code style
"
"7bd3c009fee54a5eeb0d088ffa29c6a38c1e9114","2016-04-25 22:07:51+08:00","Fix crash when chunk 2MB bigger files
"
"2c7e133228451a934a61ad8d695c85458c286424","2016-04-25 23:08:53+08:00","Support enable or disable client-side-encryption in settings menu
"
"131fdf16b9985681a07fe3ca0691a5d10baae61e","2016-05-15 13:53:42+08:00","Fix potential bugs and improve code style
"
"7843421f28fca97b22f253333014fb71e891ea1e","2016-05-15 15:12:15+08:00","Fix travis build error
"
"aa7de89e3da32bf8369d3883521a9051aa1a4d8b","2016-05-16 22:31:22+08:00","Improve code style
"
"69485e7a754233b6d5816e8d469183c195ba8863","2016-05-17 22:06:36+08:00","Persist encKey and encIv in local database
"
"d03dc444a1a36d0cb8281e616ae3e4fb468eeaf3","2016-05-17 23:26:36+08:00","Fix crash when Activity detached
"
"4be5eddfe3a8d36f8b0e1c817660b0e6b8f3b8e5","2016-05-17 23:46:50+08:00","Update title when switching tabs
"
"e36d1549b46e2c58b9f5da5da61ff6cd8af13a76","2016-05-18 00:10:24+08:00","Show loading progress, error or empty message accordingly in ActivitiesFragment
"
"6aa9d4ef1ef4bbd5d7d59f8ea81f6f5fd61b8de8","2016-05-18 00:29:08+08:00","Set the number of pages that should be retained to be 3
"
"27d394e631f52429f20ad518f8b6c42458b72235","2016-05-18 00:48:38+08:00","Update i18n
"
"25f12bfbe309c644b6f9259404e928f121f42830","2016-05-18 13:58:31+08:00","update i18n
"
"23ba5b590dd8b46f13f5bbbe735fb969e7e982fd","2016-05-18 13:59:39+08:00","Update version code
"
"d872e69755df46b28a3c688dab70dfcb26f841f5","2016-05-20 10:06:59+08:00","update i18n
"
"f0be8e97175af0cc1911fcdb6c48e3545943576a","2016-05-21 10:28:00+08:00","Upgrade database version
"
"e1b97bb2be38d7c3f66e803e7709e5e8c9c046bb","2016-05-21 10:46:00+08:00","Update i18n
"
"e6d1504e042fd15d27043dae4ffe958aa31b8804","2016-05-24 11:02:59+08:00","Notify file blocks summary downloading progress properly
"
"d35000bd80cdeae48949353dfe8e32e9308e2174","2016-05-24 11:49:09+08:00","Merge pull request #526 from Logan676/feature/notify_file_blocks_transfer_progress

Notify summary progress of file blocks downloading
"
"abe2c66f9bae6debdb062fca69e5910724001772","2016-05-24 11:53:46+08:00","Fix multi files download in enc repos failed bug
"
"87014612ba291c65c4a8d23fa488e40c994a1123","2016-05-24 12:11:09+08:00","Merge pull request #527 from Logan676/fix/multi_files_download_in_enc_lib_bug

Fix multi files download failed bug in enc repos
"
"010b8d6ad967248cf756f915254ba3402766fc81","2016-05-24 11:58:41+08:00","Fix IllegalArgumentException when resuming Settings page after cleared cache
"
"751f67a1bf51091064243fa783ee3de3e3410a83","2016-05-24 16:07:48+08:00","Merge pull request #528 from Logan676/fix/IllegalArgumentException

Fix illegal argument exception when resuming Settings page after cleared caches
"
"c3502256d174ca6257f31cda25bb08c7bd421bbc","2016-05-24 16:03:11+08:00","Support clear password
"
"5e35fba6c270b0782bf282adce667681be59f148","2016-05-24 16:15:48+08:00","Merge pull request #530 from Logan676/feature/clear_password

Support clear passwords of encrypted repos
"
"08e441e76fdf417997b1533ed1a83b8269700ff5","2016-05-24 16:21:51+08:00","Update i18n
"
"5c0740d6e78e324a3be11863fa9f502ed66cfe78","2016-05-25 23:27:47+08:00","Encryption only works among all Seafile platforms in encVersion 2
"
"54c86d1980a21d8970e1adb675106a5f7467b4a4","2016-05-25 23:34:20+08:00","Refactor methods to avoid code duplication
"
"7e0abd413c66354c42bf4373630d4d1be5c46656","2016-05-25 23:44:28+08:00","Refactor DataManager methods to avoid code duplication
"
"d9f6308d75703aa5723d310e28ef35f9be44153e","2016-05-25 23:48:21+08:00","Refactor DataManager methods to avoid code duplication again
"
"3e58642fe18040e623d6795f4e9d6c58e546921e","2016-05-26 00:09:04+08:00","Remove chunks byte arrays to save memory
"
"0eae22c4b951f4d90676ef0e500014af3d5a9533","2016-05-26 00:22:02+08:00","Use DataInputStream to returns the number of bytes actually read
"
"c983b80d4e9437976dc106a19ba80fd47e0bb506","2016-05-26 09:43:29+08:00","Merge pull request #531 from Logan676/fix/several_review_issues

Fix several review issues for #487
"
"12329014a8541b2da3df6d498e2045b8dc486b6b","2016-05-26 09:48:48+08:00","Merge branch 'develop'
"
"2b5e5a1e6874310604797ec3ba124106c0148aaf","2016-05-26 09:50:09+08:00","Update i18n
"
